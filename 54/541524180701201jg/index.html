<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":false,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":0,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="基于javaweb的SpringBoot游戏虚拟交易系统(java+springboot+mybatis+jquery+html+jsp+mysql)">
<meta property="og:site_name" content="Java源码社">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/541524180701201jg/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<link rel="stylesheet" type="text/css" href="/css/injector/main.css" /><link rel="preload" as="style" href="/css/injector/light.css" /><link rel="preload" as="style" href="/css/injector/dark.css" />
  <title>基于javaweb的SpringBoot游戏虚拟交易系统(java+springboot+mybatis+jquery+html+jsp+mysql) | Java源码社</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Java源码社</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>联系站长</a>

  </li>
        <li class="menu-item menu-item-remote">

    <a href="/remote/" rel="section"><i class="fa fa-link fa-fw"></i>远程说明</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索...书店、票、购物、图书、学生…" spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/541524180701201jg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="购买方式见各详情页<b>底部</b><br>所有项目均可<b><a href="/remote">免费远程</a></b>搭建调试运行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java源码社">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
			<!--
            /
			-->
			基于javaweb的SpringBoot游戏虚拟交易系统(java+springboot+mybatis+jquery+html+jsp+mysql)
            
        </h1>

        <div class="post-meta">
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time id="dateText" itemprop="dateModified">更新:1970年01月</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><span hidden>——————————DescriptionStart——————————</span></p>
<h3 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h3><p>Java≥8、MySQL≥5.7</p>
<h3 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h3><p>eclipse/idea/myeclipse/sts等均可配置运行</p>
<h3 id="适用"><a href="#适用" class="headerlink" title="适用"></a>适用</h3><p>课程设计，大作业，毕业设计，项目练习，学习演示等</p>
<h3 id="功能说明"><a href="#功能说明" class="headerlink" title="功能说明"></a>功能说明</h3><p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/431424150701.jpg" alt="431424150701"></p>
<p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/441424150701.jpg" alt="441424150701"></p>
<p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/451424150701.jpg" alt="451424150701"></p>
<p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/461424150701.jpg" alt="461424150701"></p>
<p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/481424150701.jpg" alt="481424150701"></p>
<p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/491424150701.jpg" alt="491424150701"></p>
<p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/501424150701.jpg" alt="501424150701"></p>
<p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/511424150701.jpg" alt="511424150701"></p>
<p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/521424150701.jpg" alt="521424150701"></p>
<p><img src="https://yms-1257401191.cos.ap-nanjing.myqcloud.com/project25/531424150701.jpg" alt="531424150701"></p>
<p>基于javaweb的SpringBoot游戏虚拟交易系统(java+springboot+mybatis+jquery+html+jsp+mysql)</p>
<p>  </p>
<p>项目介绍</p>
<p>基于SpringBoot 网络游戏虚拟交易系统 有前台和后台</p>
<p>用户:</p>
<p>登录、注册、首页、公告信息、游戏资讯、商品信息、交流论坛、商品信息、购物车、立即购买、星级好评，文字评论</p>
<p>管理员:</p>
<p>登录、验证，轮播图管理、公告信息管理、资源管理、商城管理（分类管理、商品信息管理、订单管理）、系统用户、模块管理</p>
<p>环境需要</p>
<p>1.运行环境：最好是java jdk 1.8，我们在这个平台上运行的。其他版本理论上也可以。 2.IDE环境：IDEA，Eclipse,Myeclipse都可以。推荐IDEA; 3.硬件环境：windows 7/8/10 1G内存以上；或者 Mac OS； 4.数据库：MySql 5.7/8.0版本均可； 5.是否Maven项目：是；</p>
<p>技术栈</p>
<p>后端：SpringBoot(Spring+SpringMVC+Mybatis)</p>
<p>前端:  JSP+HTML+Layui+thymeleaf+CSS+Javascript+JQUERY</p>
<p>使用说明</p>
<p>项目运行： 1. 使用Navicat或者其它工具，在mysql中创建对应sql文件名称的数据库，并导入项目的sql文件； 2. 使用IDEA/Eclipse/MyEclipse导入项目，导入成功后请执行maven clean;maven install命令，然后运行； 3. 将项目中application.yml配置文件中的数据库配置改为自己的配置;</p>
<p><span hidden>——————————CodeStart——————————</span></p>
<p>公告管理控制层：</p>
<p>/**</p>
<ul>
<li><p>
</p></li>
<li><p> 消息通知控制器</p>
</li>
<li><p></p>

</li>
</ul>
<p>*/</p>
<p>@Controller</p>
<p>public class NoticesController {</p>
<p>@Autowired</p>
<p>private NoticesService noticesService;</p>
<p>/**</p>
<ul>
<li><p>用户查看通知消息后</p>
</li>
<li><p>1.前端传入通知id（id）</p>
</li>
<li><p>2.将其设置为已读</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@PutMapping(“/notices/look/{id}”)</p>
<p>public ResultVo LookNoticesById (@PathVariable(“id”) String id) {</p>
<p>Integer i = noticesService.updateNoticesById(id);</p>
<p>if (i == 1){</p>
<p>return new ResultVo(true, StatusCode.OK,”设置成功”);</p>
<p>return new ResultVo(true, StatusCode.ERROR,”设置失败”);</p>
<p>/**</p>
<p>*查询前10条公告</p>
<ul>
<li>**/</li>
</ul>
<p>@ResponseBody</p>
<p>@GetMapping(“/notices/queryNotices”)</p>
<p>public ResultVo queryNotices (HttpSession session){</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>List<Notices> noticesList = noticesService.queryNotices(userid);</Notices></p>
<p>return new ResultVo(true,StatusCode.OK,”查询成功”,noticesList);</p>
<p>/**</p>
<ul>
<li><p>取消新通知标志</p>
</li>
<li><p>用户点击查看最新通知后会将所有通知设置为非最新通知</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@GetMapping(“/notices/cancelLatest”)</p>
<p>public ResultVo CancelLatest (HttpSession session){</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>Integer i = noticesService.CancelLatest(userid);</p>
<p>if (i == 1){</p>
<p>return new ResultVo(true,StatusCode.OK,”设置成功”);</p>
<p>return new ResultVo(true,StatusCode.ERROR,”设置失败”);</p>
<p>/**</p>
<ul>
<li><p>分类分页查询用户所有通知消息</p>
</li>
<li><p>1.前端传入消息通知类型（tpname）</p>
</li>
<li><p>2.session中获取用户id（userid）</p>
</li>
<li><p>3.返回分页数据</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@GetMapping(“/notices/queryall”)</p>
<p>public LayuiPageVo queryallSold(int limit, int page, HttpSession session) {</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>List<Notices> noticesList = noticesService.queryAllNotices((page - 1) * limit, limit, userid);</Notices></p>
<p>Integer dataNumber = noticesService.queryNoticesCount(userid);</p>
<p>return new LayuiPageVo(“”, 0,dataNumber,noticesList);</p>
<p>商品信息管理控制层：</p>
<p>/**</p>
<ul>
<li><p>
</p></li>
<li><p> 前端控制器</p>
</li>
<li><p></p>

</li>
</ul>
<p>*/</p>
<p>@Controller</p>
<p>public class CommodityController {</p>
<p>@Autowired</p>
<p>private CommodityService commodityService;</p>
<p>@Autowired</p>
<p>private CommimagesService commimagesService;</p>
<p>@Autowired</p>
<p>private LoginService loginService;</p>
<p>@Autowired</p>
<p>private UserInfoService userInfoService;</p>
<p>@Autowired</p>
<p>private SoldrecordService soldrecordService;</p>
<p>@Autowired</p>
<p>private CollectService collectService;</p>
<p>@Autowired</p>
<p>private NoticesService noticesService;</p>
<p>/**</p>
<ul>
<li>跳转到发布商品</li>
</ul>
<p>*/</p>
<p>@GetMapping(“/user/relgoods”)</p>
<p>public String torelgoods(HttpSession session){</p>
<p>/*String userid = (String)session.getAttribute(“userid”);</p>
<p>if(userid==null){</p>
<p>return “redirect:/:”;</p>
<p>}*/</p>
<p>return “/user/product/relgoods”;</p>
<p>/**</p>
<ul>
<li><p>跳转到修改商品</p>
</li>
<li><p> –不能修改已删除、已完成的商品</p>
</li>
<li><p> 1、查询商品详情</p>
</li>
<li><p> 2、查询商品得其他图</p>
</li>
</ul>
<p>*/</p>
<p>@GetMapping(“/user/editgoods/{commid}”)</p>
<p>public String toeditgoods(@PathVariable(“commid”)String commid, HttpSession session, ModelMap modelMap){</p>
<p>/*String userid = (String)session.getAttribute(“userid”);</p>
<p>if(userid==null){</p>
<p>return “redirect:/:”;</p>
<p>}*/</p>
<p>Commodity commodity=commodityService.LookCommodity(new Commodity().setCommid(commid));</p>
<p>if(commodity.getCommstatus().equals(2) || commodity.getCommstatus().equals(4)){</p>
<p>return “/error/404”;//商品已被删除或已完成交易</p>
<p>String[] commons=commodity.getCommon().split(“、”);</p>
<p>commodity.setCommon(commons[0]);</p>
<p>modelMap.put(“goods”,commodity);</p>
<p>modelMap.put(“otherimg”,commimagesService.LookGoodImages(commid));</p>
<p>return “/user/product/changegoods”;</p>
<p>/**</p>
<ul>
<li><p>修改商品</p>
</li>
<li><p>1、修改商品信息</p>
</li>
<li><p>2、修改商品的其他图的状态</p>
</li>
<li><p>3、插入商品的其他图</p>
</li>
</ul>
<p>*/</p>
<p>@PostMapping(“/changegoods/rel”)</p>
<p>@ResponseBody</p>
<p>public String changegoods(@RequestBody Commodity commodity, HttpSession session){</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>commodity.setUpdatetime(new Date()).setCommstatus(3);</p>
<p>//commodity.setCommon(commodity.getCommon()+”、”+commodity.getCommon2());//常用选项拼接</p>
<p>commodityService.ChangeCommodity(commodity);</p>
<p>commimagesService.DelGoodImages(commodity.getCommid());</p>
<p>List<Commimages> commimagesList=new ArrayList&lt;&gt;();</Commimages></p>
<p>for (String list:commodity.getOtherimg()) {</p>
<p>commimagesList.add(new Commimages().setId(KeyUtil.genUniqueKey()).setCommid(commodity.getCommid()).setImage(list));</p>
<p>commimagesService.InsertGoodImages(commimagesList);</p>
<p>/*<em>发出待审核系统通知</em>/</p>
<p>Notices notices = new Notices().setId(KeyUtil.genUniqueKey()).setUserid(userid).setTpname(“商品审核”)</p>
<p>.setWhys(“您的商品 &lt;a href=/product-detail/“+commodity.getCommid()+” style=&quot;color:#08bf91&quot; target=&quot;_blank&quot; &gt;”+commodity.getCommname()+” 进入待审核队列，请您耐心等待。”);</p>
<p>noticesService.insertNotices(notices);</p>
<p>return “0”;</p>
<p>/**</p>
<ul>
<li><p>发布商品</p>
</li>
<li><p>1、插入商品信息</p>
</li>
<li><p>2、插入商品其他图</p>
</li>
</ul>
<p>*/</p>
<p>@PostMapping(“/relgoods/rel”)</p>
<p>@ResponseBody</p>
<p>public String relgoods(@RequestBody Commodity commodity, HttpSession session){</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>UserInfo userInfo = userInfoService.LookUserinfo(userid);</p>
<p>String commid = KeyUtil.genUniqueKey();</p>
<p>commodity.setCommid(commid).setUserid(userid).setServer(userInfo.getServer());//商品id</p>
<p>//commodity.setCommon(commodity.getCommon()+”、”+commodity.getCommon2());//常用选项拼接</p>
<p>commodityService.InsertCommodity(commodity);</p>
<p>List<Commimages> commimagesList=new ArrayList&lt;&gt;();</Commimages></p>
<p>for (String list:commodity.getOtherimg()) {</p>
<p>commimagesList.add(new Commimages().setId(KeyUtil.genUniqueKey()).setCommid(commid).setImage(list));</p>
<p>commimagesService.InsertGoodImages(commimagesList);</p>
<p>/*<em>发出待审核系统通知</em>/</p>
<p>Notices notices = new Notices().setId(KeyUtil.genUniqueKey()).setUserid(userid).setTpname(“商品审核”)</p>
<p>.setWhys(“您的商品 &lt;a href=/product-detail/“+commid+” style=&quot;color:#08bf91&quot; target=&quot;_blank&quot; &gt;”+commodity.getCommname()+” 进入待审核队列，请您耐心等待。”);</p>
<p>noticesService.insertNotices(notices);</p>
<p>return “0”;</p>
<p>/**</p>
<ul>
<li>上传视频和主图</li>
</ul>
<p>*/</p>
<p>@PostMapping(“/relgoods/video”)</p>
<p>@ResponseBody</p>
<p>public JSONObject relgoodsvideo(@RequestParam(value = “file”, required = false) MultipartFile file) throws IOException {</p>
<p>JSONObject res = new JSONObject();</p>
<p>JSONObject resUrl = new JSONObject();</p>
<p>String filename = UUID.randomUUID().toString().replaceAll(“-“, “”);</p>
<p>String ext = FilenameUtils.getExtension(file.getOriginalFilename());</p>
<p>String filenames = filename + “.” + ext;</p>
<p>String pathname = “D:/file/“ + filenames;</p>
<p>file.transferTo(new File(pathname));</p>
<p>resUrl.put(“src”, “/pic/“+filenames);</p>
<p>res.put(“msg”, “”);</p>
<p>res.put(“code”, 0);</p>
<p>res.put(“data”, resUrl);</p>
<p>return res;</p>
<p>/**</p>
<ul>
<li>上传其他图片</li>
</ul>
<p>*/</p>
<p>@PostMapping(value=”/relgoods/images”)</p>
<p>@ResponseBody</p>
<p>public JSONObject relgoodsimages(@RequestParam(value = “file”, required = false) MultipartFile[] file) throws IOException {</p>
<p>JSONObject res = new JSONObject();</p>
<p>JSONObject resUrl = new JSONObject();</p>
<p>List<String> imageurls=new ArrayList&lt;&gt;();</String></p>
<p>for (MultipartFile files:file){</p>
<p>String filename = UUID.randomUUID().toString().replaceAll(“-“, “”);</p>
<p>String ext = FilenameUtils.getExtension(files.getOriginalFilename());</p>
<p>String filenames = filename + “.” + ext;</p>
<p>String pathname = “D:/file/“ + filenames;</p>
<p>files.transferTo(new File(pathname));</p>
<p>imageurls.add(“/pic/“+filenames);</p>
<p>res.put(“msg”, “”);</p>
<p>res.put(“code”, 0);</p>
<p>resUrl.put(“src”, imageurls);</p>
<p>res.put(“data”, resUrl);</p>
<p>return res;</p>
<p>/**</p>
<ul>
<li><p>商品详情</p>
</li>
<li><p>根据商品id（commid）查询商品信息、用户昵称及头像</p>
</li>
<li><p>用户可以查看正常的商品</p>
</li>
<li><p>商品发布者和管理员可以查看</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@GetMapping(“/product-detail/{commid}”)</p>
<p>public String product_detail(@PathVariable(“commid”) String commid, ModelMap modelMap,HttpSession session){</p>
<p>String couserid = (String) session.getAttribute(“userid”);</p>
<p>System.out.println(“commid = “+commid);</p>
<p>System.out.println(“commodity = “ + commodityService.LookCommodity(new Commodity().setCommid(commid).setCommstatus(1)).getImage());</p>
<p>Commodity commodity = commodityService.LookCommodity(new Commodity().setCommid(commid).setCommstatus(1));</p>
<p>int i = 0;</p>
<p>if (commodity.getCommstatus().equals(1)){//如果商品正常</p>
<p>i=1;</p>
<p>}else if (!StringUtils.isEmpty(couserid)){//如果用户已登录</p>
<p>Login login = loginService.userLogin(new Login().setUserid(couserid));</p>
<p>/*<em>商品为违规状态时：本人和管理员可查看</em>/</p>
<p>if (commodity.getCommstatus().equals(0) &amp;&amp; (commodity.getUserid().equals(couserid) || (login.getRoleid().equals(2) || login.getRoleid().equals(3)))){</p>
<p>i=1;</p>
<p>/*<em>商品为待审核状态时：本人和管理员可查看</em>/</p>
<p>}else if (commodity.getCommstatus().equals(3) &amp;&amp; (commodity.getUserid().equals(couserid) || (login.getRoleid().equals(2) || login.getRoleid().equals(3)))){</p>
<p>i=1;</p>
<p>/*<em>商品为已售出状态时：本人和管理员可查看</em>/</p>
<p>}else if (commodity.getCommstatus().equals(4) &amp;&amp; (commodity.getUserid().equals(couserid) || (login.getRoleid().equals(2) || login.getRoleid().equals(3)))){</p>
<p>i=1;</p>
<p>if(i==1){</p>
<p>commodity.setOtherimg(commimagesService.LookGoodImages(commid));</p>
<p>/*<em>商品浏览量+1</em>/</p>
<p>commodityService.ChangeCommodity(new Commodity().setCommid(commid).setRednumber(1));</p>
<p>modelMap.put(“userinfo”,userInfoService.queryPartInfo(commodity.getUserid()));</p>
<p>modelMap.put(“gddetail”,commodity);</p>
<p>//如果没有用户登录</p>
<p>if (StringUtils.isEmpty(couserid)){</p>
<p>modelMap.put(“collectstatus”,2);</p>
<p>}else {</p>
<p>Collect collect = collectService.queryCollectStatus(new Collect().setCommid(commid).setCouserid(couserid));</p>
<p>if(collect!=null){</p>
<p>if (collect.getCollstatus() == 2){</p>
<p>modelMap.put(“collectstatus”,2);</p>
<p>}else {</p>
<p>modelMap.put(“collectstatus”,1);</p>
<p>}else {</p>
<p>modelMap.put(“collectstatus”,2);</p>
<p>return “/common/product-detail”;</p>
<p>}else{</p>
<p>return “/error/404”;</p>
<p>/**</p>
<ul>
<li><p>搜索商品分页数据</p>
</li>
<li><p>前端传入搜索的商品名（commname）</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@GetMapping(“/product/search/number/{commname}”)</p>
<p>@ResponseBody</p>
<p>public PageVo searchCommodityNumber(@PathVariable(“commname”) String commname){</p>
<p>Integer dataNumber = commodityService.queryCommodityByNameCount(commname);</p>
<p>return new PageVo(StatusCode.OK,”查询成功”,dataNumber);</p>
<p>/**</p>
<ul>
<li><p>搜索商品</p>
</li>
<li><p>前端传入当前页数（nowPaging）、搜索的商品名（commname）</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@GetMapping(“/product/search/{nowPaging}/{commname}”)</p>
<p>@ResponseBody</p>
<p>public ResultVo searchCommodity(@PathVariable(“nowPaging”) Integer page, @PathVariable(“commname”) String commname){</p>
<p>List<Commodity> commodityList = commodityService.queryCommodityByName((page - 1) * 20, 20, commname);</Commodity></p>
<p>if(!StringUtils.isEmpty(commodityList)){//如果有对应商品</p>
<p>for (Commodity commodity : commodityList) {</p>
<p>/*<em>查询商品对应的其它图片</em>/</p>
<p>List<String> imagesList = commimagesService.LookGoodImages(commodity.getCommid());</String></p>
<p>commodity.setOtherimg(imagesList);</p>
<p>return new ResultVo(true,StatusCode.OK,”查询成功”,commodityList);</p>
<p>}else{</p>
<p>return new ResultVo(true,StatusCode.ERROR,”没有相关商品”);</p>
<p>/**</p>
<ul>
<li><p>首页分类展示商品 –&gt; 按照分类查询商品</p>
</li>
<li><p>前端传入商品类别（category）</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@GetMapping(“/index/product/{category}”)</p>
<p>public ResultVo indexCommodity(@PathVariable(“category”) String category) {</p>
<p>List<Commodity> commodityList = commodityService.queryCommodityByCategory(category);</Commodity></p>
<p>for (Commodity commodity : commodityList) {</p>
<p>/*<em>查询商品对应的其它图片</em>/</p>
<p>List<String> imagesList = commimagesService.LookGoodImages(commodity.getCommid());</String></p>
<p>commodity.setOtherimg(imagesList);</p>
<p>return new ResultVo(true,StatusCode.OK,”查询成功”,commodityList);</p>
<p>/**</p>
<ul>
<li><p>查询最新发布的8条商品</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@GetMapping(“/product/latest”)</p>
<p>public ResultVo latestCommodity() {</p>
<p>String category = “全部”;</p>
<p>List<Commodity> commodityList = commodityService.queryCommodityByCategory(category);</Commodity></p>
<p>for (Commodity commodity : commodityList) {</p>
<p>/*<em>查询商品对应的其它图片</em>/</p>
<p>List<String> imagesList = commimagesService.LookGoodImages(commodity.getCommid());</String></p>
<p>commodity.setOtherimg(imagesList);</p>
<p>return new ResultVo(true,StatusCode.OK,”查询成功”,commodityList);</p>
<p>/**</p>
<ul>
<li><p>产品清单分页数据</p>
</li>
<li><p>前端传入商品类别（category）、区域（area）</p>
</li>
<li><p>最低价（minmoney）、最高价（maxmoney）</p>
</li>
<li><p>后端根据session查出个人本校信息（server）</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@GetMapping(“/list-number/{category}/{area}/{minmoney}/{maxmoney}”)</p>
<p>@ResponseBody</p>
<p>public PageVo productListNumber(@PathVariable(“category”) String category, @PathVariable(“area”) String area,</p>
<p>@PathVariable(“minmoney”) BigDecimal minmoney, @PathVariable(“maxmoney”) BigDecimal maxmoney,</p>
<p>HttpSession session) {</p>
<p>String server=null;</p>
<p>if(!area.equals(“全部”)){</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>UserInfo userInfo = userInfoService.LookUserinfo(userid);</p>
<p>server = userInfo.getServer();</p>
<p>Integer dataNumber = commodityService.queryAllCommodityByCategoryCount(area, server, category, minmoney, maxmoney);</p>
<p>return new PageVo(StatusCode.OK,”查询成功”,dataNumber);</p>
<p>/**</p>
<ul>
<li><p>产品清单界面</p>
</li>
<li><p>前端传入商品类别（category）、当前页码（nowPaging）、区域（area）</p>
</li>
<li><p>最低价（minmoney）、最高价（maxmoney）、价格升序降序（price：0.不排序 1.升序 2.降序）</p>
</li>
<li><p>后端根据session查出个人本校信息（server）</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@GetMapping(“/product-listing/{category}/{nowPaging}/{area}/{minmoney}/{maxmoney}/{price}”)</p>
<p>@ResponseBody</p>
<p>public ResultVo productlisting(@PathVariable(“category”) String category, @PathVariable(“nowPaging”) Integer page,</p>
<p>@PathVariable(“area”) String area, @PathVariable(“minmoney”) BigDecimal minmoney, @PathVariable(“maxmoney”) BigDecimal maxmoney,</p>
<p>@PathVariable(“price”) Integer price, HttpSession session) {</p>
<p>String server=null;</p>
<p>if(!area.equals(“全部”)) {</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>UserInfo userInfo = userInfoService.LookUserinfo(userid);</p>
<p>server = userInfo.getServer();</p>
<p>List<Commodity> commodityList = commodityService.queryAllCommodityByCategory((page - 1) * 16, 16, area, server, category, minmoney, maxmoney);</Commodity></p>
<p>for (Commodity commodity : commodityList) {</p>
<p>/*<em>查询商品对应的其它图片</em>/</p>
<p>List<String> imagesList = commimagesService.LookGoodImages(commodity.getCommid());</String></p>
<p>commodity.setOtherimg(imagesList);</p>
<p>/*<em>自定义排序</em>/</p>
<p>if (price != 0){</p>
<p>if (price == 1){</p>
<p>/*<em>升序</em>/</p>
<p>Collections.sort(commodityList, new Comparator<Commodity>() {//此处创建了一个匿名内部类</Commodity></p>
<p>int i;</p>
<p>@Override</p>
<p>public int compare(Commodity o1, Commodity o2) {</p>
<p>if (o1.getThinkmoney().compareTo(o2.getThinkmoney()) &gt; -1) {</p>
<p>System.out.println(“===o1大于等于o2===”);</p>
<p>i = 1;</p>
<p>} else if (o1.getThinkmoney().compareTo(o2.getThinkmoney()) &lt; 1) {</p>
<p>i = -1;</p>
<p>System.out.println(“===o1小于等于o2===”);</p>
<p>return i;</p>
<p>});</p>
<p>}else if (price == 2){</p>
<p>/*<em>降序</em>/</p>
<p>Collections.sort(commodityList, new Comparator<Commodity>() {//此处创建了一个匿名内部类</Commodity></p>
<p>int i;</p>
<p>@Override</p>
<p>public int compare(Commodity o1, Commodity o2) {</p>
<p>if (o1.getThinkmoney().compareTo(o2.getThinkmoney()) &gt; -1) {</p>
<p>System.out.println(“===o1大于等于o2===”);</p>
<p>i = -1;</p>
<p>} else if (o1.getThinkmoney().compareTo(o2.getThinkmoney()) &lt; 1) {</p>
<p>System.out.println(“===o1小于等于o2===”);</p>
<p>i = 1;</p>
<p>return i;</p>
<p>});</p>
<p>return new ResultVo(true,StatusCode.OK,”查询成功”,commodityList);</p>
<p>/**</p>
<ul>
<li>分页展示个人各类商品信息</li>
</ul>
<p>*前端传入页码、分页数量</p>
<p>*前端传入商品信息状态码（commstatus）–&gt;全部:100，已审核:1，待审核:3，违规:0，已完成:4</p>
<p>*/</p>
<p>@GetMapping(“/user/commodity/{commstatus}”)</p>
<p>@ResponseBody</p>
<p>public LayuiPageVo userCommodity(@PathVariable(“commstatus”) Integer commstatus, int limit, int page, HttpSession session) {</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>//如果未登录，给一个假id</p>
<p>if(StringUtils.isEmpty(userid)){</p>
<p>userid = “123456”;</p>
<p>List<Commodity> commodityList=null;</Commodity></p>
<p>Integer dataNumber;</p>
<p>if(commstatus==100){</p>
<p>commodityList = commodityService.queryAllCommodity((page - 1) * limit, limit, userid,null);</p>
<p>dataNumber = commodityService.queryCommodityCount(userid,null);</p>
<p>}else{</p>
<p>commodityList = commodityService.queryAllCommodity((page - 1) * limit, limit, userid,commstatus);</p>
<p>dataNumber = commodityService.queryCommodityCount(userid,commstatus);</p>
<p>return new LayuiPageVo(“”,0,dataNumber,commodityList);</p>
<p>/**</p>
<ul>
<li><p>个人对商品的操作</p>
</li>
<li><p>前端传入商品id（commid）</p>
</li>
<li><p>前端传入操作的商品状态（commstatus）–&gt;删除:2  已完成:4</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@GetMapping(“/user/changecommstatus/{commid}/{commstatus}”)</p>
<p>public ResultVo ChangeCommstatus( @PathVariable(“commid”) String commid, @PathVariable(“commstatus”) Integer commstatus, HttpSession session) {</p>
<p>Integer i = commodityService.ChangeCommstatus(commid, commstatus);</p>
<p>if (i == 1){</p>
<p>/*<em>如果商品已售出</em>/</p>
<p>// dddd</p>
<p>if (commstatus == 4){</p>
<p>/*<em>查询售出商品的信息</em>/</p>
<p>Commodity commodity = commodityService.LookCommodity(new Commodity().setCommid(commid));</p>
<p>Soldrecord soldrecord = new Soldrecord();</p>
<p>//                String userid1 = (String) session.getAttribute(“userid”);</p>
<p>String userid2 = (String) commodity.getUserid();</p>
<p>//                /*<em>将商品信息添加到售出记录中 —— 买家1</em>/</p>
<p>// 没有设置买家数据位置，暂时不做功能</p>
<p>//                soldrecord.setId(KeyUtil.genUniqueKey()).setCommid(commid).setCommname(commodity.getCommname()).setCommdesc(commodity.getCommdesc())</p>
<p>//                .setThinkmoney(commodity.getThinkmoney()).setUserid(userid1);</p>
<p>/*<em>将商品信息添加到售出记录中 —— 卖家2</em>/</p>
<p>soldrecord.setId(KeyUtil.genUniqueKey()).setCommid(commid).setCommname(commodity.getCommname()).setCommdesc(commodity.getCommdesc())</p>
<p>.setThinkmoney(commodity.getThinkmoney()).setUserid(userid2);</p>
<p>/*<em>添加售出记录</em>/</p>
<p>soldrecordService.insertSold(soldrecord);</p>
<p>/*<em>发出评论通知消息</em>/</p>
<p>Notices notices = new Notices().setId(KeyUtil.genUniqueKey()).setUserid(userid2).setTpname(“购买”)</p>
<p>.setWhys(“您的商品 &lt;a href=/product-detail/“+commid+” style=&quot;color:#08bf91&quot; target=&quot;_blank&quot; &gt;”+commodity.getCommname()+” 被购买了，快去看看吧。”);</p>
<p>noticesService.insertNotices(notices);</p>
<p>return new ResultVo(true,StatusCode.OK,”操作成功”);</p>
<p>return new ResultVo(false,StatusCode.ERROR,”操作失败”);</p>
<p>登录管理控制层： </p>
<p>/**</p>
<ul>
<li><p>
</p></li>
<li><p> 登录注册 控制器</p>
</li>
<li><p></p>

</li>
</ul>
<p>*/</p>
<p>@Controller</p>
<p>public class LoginController {</p>
<p>@Autowired</p>
<p>private LoginService loginService;</p>
<p>@Autowired</p>
<p>private UserInfoService userInfoService;</p>
<p>@Autowired</p>
<p>private UserRoleService userRoleService;</p>
<p>/*<em>手机号和注册验证码map集合</em>/</p>
<p>private static Map&lt;String, String&gt; phonecodemap1 = new HashMap&lt;&gt;();</p>
<p>/*<em>手机号和重置密码验证码map集合</em>/</p>
<p>private static Map&lt;String, String&gt; phonecodemap2 = new HashMap&lt;&gt;();</p>
<p>/**</p>
<p>*图片验证码</p>
<ul>
<li>*/</li>
</ul>
<p>@RequestMapping(value = “/images”, method = {RequestMethod.GET, RequestMethod.POST})</p>
<p>public void images(HttpServletResponse response) throws IOException {</p>
<p>response.setContentType(“image/jpeg”);</p>
<p>//禁止图像缓存。</p>
<p>response.setHeader(“Pragma”, “no-cache”);</p>
<p>response.setHeader(“Cache-Control”, “no-cache”);</p>
<p>response.setDateHeader(“Expires”, 0);</p>
<p>ValidateCode vCode = new ValidateCode(820, 200, 5, 80);</p>
<p>vCode.write(response.getOutputStream());</p>
<p>/**注册时发送短信验证码</p>
<ul>
<li><p>1.判断是否为注册类型验证码</p>
</li>
<li><p>2.判断手机号格式是否正确</p>
</li>
<li><p>3.判断手机号是否已经注册过</p>
</li>
<li><p>4.发送注册验证码并存入map集合</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@PostMapping(“/user/sendregcode”)</p>
<p>public ResultVo sendregcode(HttpServletRequest request) throws IOException{</p>
<p>JSONObject jsonObject = JsonReader.receivePost(request);</p>
<p>final String mobilephone = jsonObject.getString(“mobilephone”);</p>
<p>Integer type = jsonObject.getInt(“type”);</p>
<p>Login login = new Login();</p>
<p>if(type!=0){</p>
<p>return new ResultVo(false,StatusCode.ACCESSERROR,”违规操作”);</p>
<p>if (!JustPhone.justPhone(mobilephone)) {//判断输入的手机号格式是否正确</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请输入正确格式的手机号”);</p>
<p>//查询手机号是否已经注册</p>
<p>login.setMobilephone(mobilephone);</p>
<p>Login userIsExist = loginService.userLogin(login);</p>
<p>if (!StringUtils.isEmpty(userIsExist)){//用户账号已经存在</p>
<p>return new ResultVo(false, StatusCode.ERROR,”该手机号已经注册过了”);</p>
<p>String code = GetCode.phonecode();</p>
<p>Integer result = new SmsUtil().SendMsg(mobilephone, code, type);//发送验证码</p>
<p>if(result == 1){//发送成功</p>
<p>phonecodemap1.put(mobilephone, code);//放入map集合进行对比</p>
<p>/*</p>
<p>final Timer timer = new Timer();</p>
<p>timer.schedule(new TimerTask() {</p>
<p>@Override</p>
<p>public void run() {</p>
<p>phonecodemap1.remove(phoneNum);</p>
<p>timer.cancel();</p>
<p>}, 5 * 60 * 1000);</p>
<p>*/</p>
<p>//执行定时任务</p>
<p>ScheduledExecutorService executorService = new ScheduledThreadPoolExecutor(1,</p>
<p>new BasicThreadFactory.Builder().namingPattern(“example-schedule-pool-%d”).daemon(true).build());</p>
<p>executorService.scheduleAtFixedRate(new Runnable() {</p>
<p>@Override</p>
<p>public void run() {</p>
<p>phonecodemap1.remove(mobilephone);</p>
<p>((ScheduledThreadPoolExecutor) executorService).remove(this::run);</p>
<p>},1 * 10 * 1000,1 * 10 * 1000, TimeUnit.HOURS);</p>
<p>return new ResultVo(true,StatusCode.SMS,”验证码发送成功”);</p>
<p>}else if(result == 2){</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请输入正确格式的手机号”);</p>
<p>return new ResultVo(false,StatusCode.REMOTEERROR,”验证码发送失败”);</p>
<p>/**注册</p>
<ul>
<li><p>1.前端传入用户名（username）、密码（password）、邮箱（email）、手机号（mobilephone）、验证码（vercode）</p>
</li>
<li><p>2.查询账号是否已经注册</p>
</li>
<li><p>3.查询用户名是否已存在</p>
</li>
<li><p>4.判断验证码是否有效或正确</p>
</li>
<li><p>5.注册</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@PostMapping(“/user/register”)</p>
<p>public  ResultVo userReg(@RequestBody UserInfo userInfo, HttpSession session) {</p>
<p>String username = userInfo.getUsername();</p>
<p>String password = userInfo.getPassword();</p>
<p>String mobilephone = userInfo.getMobilephone();</p>
<p>String vercode = userInfo.getVercode();</p>
<p>Login login = new Login().setMobilephone(mobilephone);</p>
<p>//查询账号是否已经注册</p>
<p>Login userIsExist = loginService.userLogin(login);</p>
<p>if (!StringUtils.isEmpty(userIsExist)){//用户账号已经存在</p>
<p>return new ResultVo(false, StatusCode.ERROR,”该用户已经注册过了”);</p>
<p>login.setUsername(username).setMobilephone(null);</p>
<p>Login userNameIsExist = loginService.userLogin(login);</p>
<p>if (!StringUtils.isEmpty(userNameIsExist)){//用户名已经存在</p>
<p>return new ResultVo(false, StatusCode.ERROR,”用户名已存在，请换一个吧”);</p>
<p>String rel = phonecodemap1.get(mobilephone);</p>
<p>if (StringUtils.isEmpty(rel)) {//验证码到期 或者 没发送短信验证码</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请重新获取验证码”);</p>
<p>//if (rel.equalsIgnoreCase(vercode)) {</p>
<p>if (vercode.equals(“123456”)) {//验证码正确</p>
<p>//盐加密</p>
<p>String passwords = new Md5Hash(password, “Game-shops”).toString();</p>
<p>String userid = KeyUtil.genUniqueKey();</p>
<p>login.setId(KeyUtil.genUniqueKey()).setUserid(userid).setMobilephone(mobilephone).setPassword(passwords);</p>
<p>Integer integer = loginService.loginAdd(login);</p>
<p>//新注册用户存入默认头像、存入默认签名</p>
<p>userInfo.setUserid(userid).setPassword(passwords).setUimage(“/pic/d1d66c3ea71044a9b938b00859ca94df.jpg”).</p>
<p>setSign(“如此清秋何吝酒，这般明月不须钱”).setStatus(“offline”);</p>
<p>Integer integer1 = userInfoService.userReg(userInfo);</p>
<p>if (integer==1 &amp;&amp; integer1==1){</p>
<p>/*<em>注册成功后存入session</em>/</p>
<p>session.setAttribute(“userid”,userid);</p>
<p>session.setAttribute(“username”,username);</p>
<p>/*<em>存入用户角色信息</em>/</p>
<p>userRoleService.InsertUserRole(new UserRole().setUserid(userid).setRoleid(1).setIdentity(“网站用户”));</p>
<p>UsernamePasswordToken token=new UsernamePasswordToken(mobilephone, new Md5Hash(password,”Game-shops”).toString());</p>
<p>Subject subject= SecurityUtils.getSubject();</p>
<p>subject.login(token);</p>
<p>return new ResultVo(true,StatusCode.OK,”注册成功”);</p>
<p>return new ResultVo(false,StatusCode.ERROR,”注册失败”);</p>
<p>return new ResultVo(false,StatusCode.ERROR,”验证码错误”);</p>
<p>/**登录</p>
<ul>
<li><p>1.判断输入账号的类型</p>
</li>
<li><p>2.登录</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@PostMapping(“/user/login”)</p>
<p>public ResultVo userLogin(@RequestBody Login login, HttpSession session){</p>
<p>String account=login.getUsername();</p>
<p>String password=login.getPassword();</p>
<p>String vercode=login.getVercode();</p>
<p>UsernamePasswordToken token;</p>
<p>if(!ValidateCode.code.equalsIgnoreCase(vercode)){</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请输入正确的验证码”);</p>
<p>//判断输入的账号是否手机号</p>
<p>if (!JustPhone.justPhone(account)) {</p>
<p>//输入的是用户名</p>
<p>String username = account;</p>
<p>//盐加密</p>
<p>token = new UsernamePasswordToken(username, new Md5Hash(password,”Game-shops”).toString());</p>
<p>//            System.out.println(“1password : “+new Md5Hash(password,”Game-shops”).toString());</p>
<p>}else {</p>
<p>//输入的是手机号</p>
<p>String mobilephone = account;</p>
<p>login.setMobilephone(mobilephone);</p>
<p>//将封装的login中username变为null</p>
<p>login.setUsername(null);</p>
<p>//盐加密</p>
<p>token=new UsernamePasswordToken(mobilephone, new Md5Hash(password,”Game-shops”).toString());</p>
<p>System.out.println(“2password :”+ token);</p>
<p>Subject subject= SecurityUtils.getSubject();</p>
<p>try {</p>
<p>subject.login(token);</p>
<p>//盐加密</p>
<p>String passwords = new Md5Hash(password, “Game-shops”).toString();</p>
<p>System.out.println(“3password :”+ passwords);</p>
<p>login.setPassword(passwords);</p>
<p>Login login1 = loginService.userLogin(login);</p>
<p>session.setAttribute(“userid”,login1.getUserid());</p>
<p>session.setAttribute(“username”,login1.getUsername());</p>
<p>return new ResultVo(true,StatusCode.OK,”登录成功”);</p>
<p>}catch (UnknownAccountException e){</p>
<p>return new ResultVo(true,StatusCode.LOGINERROR,”用户名不存在”);</p>
<p>}catch (IncorrectCredentialsException e){</p>
<p>return new ResultVo(true,StatusCode.LOGINERROR,”密码错误”);</p>
<p>/**重置密码时发送短信验证码</p>
<ul>
<li><p>1.判断是否为重置密码类型验证码</p>
</li>
<li><p>2.判断手机号格式是否正确</p>
</li>
<li><p>3.查询账号是否存在</p>
</li>
<li><p>4.发送验证码</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@PostMapping(“/user/sendresetpwd”)</p>
<p>public ResultVo sendresetpwd(HttpServletRequest request) throws IOException {</p>
<p>JSONObject json = JsonReader.receivePost(request);</p>
<p>final String mobilephone = json.getString(“mobilephone”);</p>
<p>Integer type = json.getInt(“type”);</p>
<p>Login login = new Login();</p>
<p>if(type!=1){</p>
<p>return new ResultVo(false,StatusCode.ACCESSERROR,”违规操作”);</p>
<p>if (!JustPhone.justPhone(mobilephone)) {//判断输入的手机号格式是否正确</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请输入正确格式的手机号”);</p>
<p>//查询手机号是否存在</p>
<p>login.setMobilephone(mobilephone);</p>
<p>Login userIsExist = loginService.userLogin(login);</p>
<p>if (StringUtils.isEmpty(userIsExist)){//用户账号不存在</p>
<p>return new ResultVo(false, StatusCode.LOGINERROR,”该用户不存在”);</p>
<p>String code = GetCode.phonecode();</p>
<p>Integer result = new SmsUtil().SendMsg(mobilephone, code, type);//发送验证码</p>
<p>if(result == 1) {//发送成功</p>
<p>phonecodemap2.put(mobilephone, code);//放入map集合进行对比</p>
<p>//执行定时任务</p>
<p>ScheduledExecutorService executorService = new ScheduledThreadPoolExecutor(1,</p>
<p>new BasicThreadFactory.Builder().namingPattern(“example-schedule-pool-%d”).daemon(true).build());</p>
<p>executorService.scheduleAtFixedRate(new Runnable() {</p>
<p>@Override</p>
<p>public void run() {</p>
<p>phonecodemap2.remove(mobilephone);</p>
<p>((ScheduledThreadPoolExecutor) executorService).remove(this::run);</p>
<p>},5 * 60 * 1000,5 * 60 * 1000, TimeUnit.HOURS);</p>
<p>return new ResultVo(true,StatusCode.SMS,”验证码发送成功”);</p>
<p>}else if(result == 2){</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请输入正确格式的手机号”);</p>
<p>return new ResultVo(false,StatusCode.REMOTEERROR,”验证码发送失败”);</p>
<p>/**重置密码</p>
<ul>
<li><p>1.判断手机号格式是否正确</p>
</li>
<li><p>2.查询手机号是否存在</p>
</li>
<li><p>3.判断验证码是否有效或正确</p>
</li>
<li><p>4.重置密码</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@PostMapping(“/user/resetpwd”)</p>
<p>public  ResultVo resetpwd(@RequestBody Login login) {</p>
<p>String mobilephone=login.getMobilephone();</p>
<p>String password=login.getPassword();</p>
<p>String vercode=login.getVercode();</p>
<p>Login login1 = new Login();</p>
<p>UserInfo userInfo = new UserInfo();</p>
<p>if (!JustPhone.justPhone(mobilephone)) {//判断输入的手机号格式是否正确</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请输入正确格式的手机号”);</p>
<p>//查询手机号是否存在</p>
<p>login1.setMobilephone(mobilephone);</p>
<p>Login userIsExist = loginService.userLogin(login1);</p>
<p>if (StringUtils.isEmpty(userIsExist)){//用户账号不存在</p>
<p>return new ResultVo(false, StatusCode.LOGINERROR,”该账号不存在”);</p>
<p>String rel = phonecodemap2.get(mobilephone);</p>
<p>if (StringUtils.isEmpty(rel)) {//验证码到期 或者 没发送短信验证码</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请重新获取验证码”);</p>
<p>if (vercode.equals(“123456”)) {//验证码正确</p>
<p>//盐加密</p>
<p>String passwords = new Md5Hash(password, “Game-shops”).toString();</p>
<p>login1.setPassword(passwords).setId(userIsExist.getId()).setMobilephone(null);</p>
<p>userInfo.setMobilephone(mobilephone).setPassword(passwords).setUserid(userIsExist.getUserid());</p>
<p>Integer integer = loginService.updateLogin(login1);</p>
<p>Integer integer1 = userInfoService.UpdateUserInfo(userInfo);</p>
<p>if (integer==1 &amp;&amp; integer1==1){</p>
<p>return new ResultVo(true,StatusCode.OK,”重置密码成功”);</p>
<p>return new ResultVo(false,StatusCode.ERROR,”重置密码失败”);</p>
<p>return new ResultVo(false,StatusCode.ERROR,”验证码错误”);</p>
<p>/*<em>退出登陆</em>/</p>
<p>@GetMapping(“/user/logout”)</p>
<p>public String logout(HttpServletRequest request,HttpSession session){</p>
<p>String userid = (String)session.getAttribute(“userid”);</p>
<p>String username = (String)session.getAttribute(“username”);</p>
<p>if(StringUtils.isEmpty(userid) &amp;&amp; StringUtils.isEmpty(username)){</p>
<p>return “redirect:/“;</p>
<p>request.getSession().removeAttribute(“userid”);</p>
<p>request.getSession().removeAttribute(“username”);</p>
<p>return “redirect:/“;</p>
<p>用户信息管理控制层：</p>
<p>/**</p>
<ul>
<li><p>
</p></li>
<li><p>个人中心 控制器</p>
</li>
<li><p></p>

</li>
</ul>
<p>*/</p>
<p>@Controller</p>
<p>public class UserController {</p>
<p>@Autowired</p>
<p>private LoginService loginService;</p>
<p>@Autowired</p>
<p>private UserInfoService userInfoService;</p>
<p>/*<em>手机号和更换手机号验证码map集合</em>/</p>
<p>private static Map&lt;String, String&gt; phonecodemap = new HashMap&lt;&gt;();</p>
<p>/**</p>
<ul>
<li><p>修改密码</p>
</li>
<li><p>1.前端传入旧密码（oldpwd）、新密码（newpwd）</p>
</li>
<li><p>2.判断输入旧密码和系统旧密码是否相等</p>
</li>
<li><p>4.修改密码</p>
</li>
</ul>
<p>*/</p>
<p>@ResponseBody</p>
<p>@PutMapping(“/user/updatepwd”)</p>
<p>public ResultVo updatepwd(HttpSession session, HttpServletRequest request) throws IOException {</p>
<p>JSONObject json = JsonReader.receivePost(request);</p>
<p>String oldpwd = json.getString(“oldpwd”);</p>
<p>String newpwd = json.getString(“newpwd”);</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>Login login = new Login();</p>
<p>UserInfo userInfo = new UserInfo();</p>
<p>login.setUserid(userid);</p>
<p>Login login1 = loginService.userLogin(login);</p>
<p>String oldpwds = new Md5Hash(oldpwd, “Game-shops”).toString();</p>
<p>//如果旧密码相等</p>
<p>if (oldpwds.equals(login1.getPassword())){</p>
<p>//盐加密</p>
<p>String passwords = new Md5Hash(newpwd, “Game-shops”).toString();</p>
<p>login.setPassword(passwords);</p>
<p>userInfo.setPassword(passwords).setUserid(login1.getUserid());</p>
<p>Integer integer = loginService.updateLogin(login);</p>
<p>Integer integer1 = userInfoService.UpdateUserInfo(userInfo);</p>
<p>if (integer == 1 &amp;&amp; integer1 == 1) {</p>
<p>return new ResultVo(true, StatusCode.OK, “修改密码成功”);</p>
<p>return new ResultVo(false, StatusCode.ERROR, “修改密码失败”);</p>
<p>return new ResultVo(false, StatusCode.LOGINERROR, “当前密码错误”);</p>
<p>/**</p>
<ul>
<li>展示用户头像昵称</li>
</ul>
<p>*/</p>
<p>@ResponseBody</p>
<p>@PostMapping(“/user/avatar”)</p>
<p>public ResultVo userAvatar( HttpSession session) {</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>UserInfo userInfo = userInfoService.queryPartInfo(userid);</p>
<p>return new ResultVo(true, StatusCode.OK, “查询头像成功”,userInfo);</p>
<p>/**</p>
<ul>
<li><p>修改头像</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@PostMapping(value = “/user/updateuimg”)</p>
<p>@ResponseBody</p>
<p>public JSONObject updateuimg(@RequestParam(value = “file”, required = false) MultipartFile file, HttpSession session) throws IOException {</p>
<p>JSONObject res = new JSONObject();</p>
<p>JSONObject resUrl = new JSONObject();</p>
<p>String filename = UUID.randomUUID().toString().replaceAll(“-“, “”);</p>
<p>String ext = FilenameUtils.getExtension(file.getOriginalFilename());//获得文件扩展名</p>
<p>String filenames = filename + “.” + ext;//文件全名</p>
<p>String pathname = “D://file/“ + filenames;</p>
<p>file.transferTo(new File(pathname));</p>
<p>resUrl.put(“src”, “/pic/“+filenames);</p>
<p>res.put(“msg”, “”);</p>
<p>res.put(“code”, 0);</p>
<p>res.put(“data”, resUrl);</p>
<p>String uimgUrl = “/pic/“ + filenames;</p>
<p>String userid=(String) session.getAttribute(“userid”);</p>
<p>UserInfo userInfo = new UserInfo().setUserid(userid).setUimage(uimgUrl);</p>
<p>userInfoService.UpdateUserInfo(userInfo);</p>
<p>return res;</p>
<p>/**</p>
<ul>
<li>展示个人信息</li>
</ul>
<p>*/</p>
<p>@RequiresPermissions(“user:userinfo”)</p>
<p>@GetMapping(“/user/lookinfo”)</p>
<p>public String lookinfo(HttpSession session, ModelMap modelMap) {</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>UserInfo userInfo = userInfoService.LookUserinfo(userid);</p>
<p>modelMap.put(“userInfo”,userInfo);</p>
<p>return “/user/userinfo”;</p>
<p>/**</p>
<ul>
<li>跳转到完善个人信息</li>
</ul>
<p>*/</p>
<p>@GetMapping(“/user/perfectinfo”)</p>
<p>public String perfectInfo(HttpSession session, ModelMap modelMap) {</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>UserInfo userInfo = userInfoService.LookUserinfo(userid);</p>
<p>modelMap.put(“perfectInfo”,userInfo);</p>
<p>return “/user/perfectinfo”;</p>
<p>/**</p>
<ul>
<li><p>修改个人信息</p>
</li>
<li><p>1.前端传入用户昵称（username）、用户邮箱（email）、性别（sex）、游戏（server</p>
</li>
<li><p>2.前端传入变更后的字段，未变更的不传入后台</p>
</li>
<li><p>3.判断更改的用户名是否已存在</p>
</li>
<li><p>4.修改个人信息</p>
</li>
</ul>
<p>*/</p>
<p>@ResponseBody</p>
<p>@PostMapping(“/user/updateinfo”)</p>
<p>public ResultVo updateInfo(@RequestBody UserInfo userInfo, HttpSession session) {</p>
<p>String username = userInfo.getUsername();</p>
<p>String sessionname = (String) session.getAttribute(“username”);</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>Login login = new Login();</p>
<p>//如果传入用户名不为空</p>
<p>if (!StringUtils.isEmpty(username)){</p>
<p>login.setUsername(username);</p>
<p>Login login1 = loginService.userLogin(login);</p>
<p>//如果用户名未修改</p>
<p>if (sessionname.equals(username)){</p>
<p>UserInfo userInfo2 = userInfoService.LookUserinfo(login1.getUserid());</p>
<p>if (userInfo.getUsername().equals(userInfo2.getUsername())</p>
<p>&amp;&amp; userInfo.getEmail().equals(userInfo2.getEmail())</p>
<p>&amp;&amp; userInfo.getSex().equals(userInfo2.getSex())</p>
<p>&amp;&amp; userInfo.getServer().equals(userInfo2.getServer())</p>
<p>){</p>
<p>return new ResultVo(false, StatusCode.ERROR, “1.尚未修改信息”);</p>
<p>} else {</p>
<p>//如果用户名已存在</p>
<p>if (!StringUtils.isEmpty(login1)) {</p>
<p>return new ResultVo(false, StatusCode.ERROR, “2.用户名已存在”);</p>
<p>login.setUserid(userid);</p>
<p>//修改登录表中用户名</p>
<p>loginService.updateLogin(login);</p>
<p>userInfo.setUserid(userid);</p>
<p>Integer integer1 = userInfoService.UpdateUserInfo(userInfo);</p>
<p>if (integer1 == 1) {</p>
<p>session.setAttribute(“username”,username);</p>
<p>return new ResultVo(true, StatusCode.OK, “修改成功”);</p>
<p>return new ResultVo(false, StatusCode.ERROR, “修改失败”);</p>
<p>/**更换手机号时发送短信验证码</p>
<ul>
<li><p>1.判断是否为更换手机号类型验证码</p>
</li>
<li><p>2.判断手机号格式是否正确</p>
</li>
<li><p>3.查询账号是否存在</p>
</li>
<li><p>4.发送验证码</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@PostMapping(“/user/sendupdatephone”)</p>
<p>public ResultVo sendupdatephone(HttpServletRequest request) throws IOException {</p>
<p>JSONObject json = JsonReader.receivePost(request);</p>
<p>final String mobilephone = json.getString(“mobilephone”);</p>
<p>Integer type = json.getInt(“type”);</p>
<p>Login login = new Login();</p>
<p>if(type!=2){</p>
<p>return new ResultVo(false,StatusCode.ACCESSERROR,”违规操作”);</p>
<p>if (!JustPhone.justPhone(mobilephone)) {//判断输入的手机号格式是否正确</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请输入正确格式的手机号”);</p>
<p>//查询手机号是否存在</p>
<p>login.setMobilephone(mobilephone);</p>
<p>Login userIsExist = loginService.userLogin(login);</p>
<p>if (!StringUtils.isEmpty(userIsExist)){//若手机号已注册过</p>
<p>return new ResultVo(false, StatusCode.REPERROR,”手机号已存在”);</p>
<p>String code = GetCode.phonecode();</p>
<p>Integer result = new SmsUtil().SendMsg(mobilephone, code, type);//发送验证码</p>
<p>if(result == 1) {//发送成功</p>
<p>phonecodemap.put(mobilephone, code);//放入map集合进行对比</p>
<p>/*</p>
<p>final Timer timer = new Timer();</p>
<p>timer.schedule(new TimerTask() {</p>
<p>@Override</p>
<p>public void run() {</p>
<p>phonecodemap2.remove(phoneNum);</p>
<p>timer.cancel();</p>
<p>}, 5 * 60 * 1000);</p>
<p>*/</p>
<p>//执行定时任务</p>
<p>ScheduledExecutorService executorService = new ScheduledThreadPoolExecutor(1,</p>
<p>new BasicThreadFactory.Builder().namingPattern(“example-schedule-pool-%d”).daemon(true).build());</p>
<p>executorService.scheduleAtFixedRate(new Runnable() {</p>
<p>@Override</p>
<p>public void run() {</p>
<p>phonecodemap.remove(mobilephone);</p>
<p>((ScheduledThreadPoolExecutor) executorService).remove(this::run);</p>
<p>},5 * 60 * 1000,5 * 60 * 1000, TimeUnit.HOURS);</p>
<p>return new ResultVo(true,StatusCode.SMS,”验证码发送成功”);</p>
<p>}else if(result == 2){</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请输入正确格式的手机号”);</p>
<p>return new ResultVo(false,StatusCode.REMOTEERROR,”验证码发送失败”);</p>
<p>/**</p>
<ul>
<li><p>修改绑定手机号</p>
</li>
<li><p>1.获取session中userid</p>
</li>
<li><p>2.修改login和userInfo中对应的手机号</p>
</li>
</ul>
<p>*/</p>
<p>@ResponseBody</p>
<p>@PutMapping(“/user/updatephone/{mobilephone}/{vercode}”)</p>
<p>public ResultVo updatephone(@PathVariable(“mobilephone”)String mobilephone,@PathVariable(“vercode”)String vercode,HttpSession session) {</p>
<p>String userid = (String) session.getAttribute(“userid”);</p>
<p>String rel = phonecodemap.get(mobilephone);</p>
<p>if (StringUtils.isEmpty(rel)) {//验证码到期 或者 没发送短信验证码</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请重新获取验证码”);</p>
<p>if (rel.equalsIgnoreCase(vercode)) {//验证码正确</p>
<p>Login login = new Login().setUserid(userid).setMobilephone(mobilephone);</p>
<p>UserInfo userInfo = new UserInfo().setUserid(userid).setMobilephone(mobilephone);</p>
<p>Integer integer = loginService.updateLogin(login);</p>
<p>Integer integer1 = userInfoService.UpdateUserInfo(userInfo);</p>
<p>if (integer == 1 &amp;&amp; integer1 == 1) {</p>
<p>return new ResultVo(true, StatusCode.OK, “更换手机号成功”);</p>
<p>return new ResultVo(false, StatusCode.SERVERERROR, “系统错误，更换失败”);</p>
<p>return new ResultVo(false,StatusCode.ERROR,”验证码错误”);</p>
<p>管理员管理控制层：</p>
<p>/**</p>
<ul>
<li>@Description: 管理员控制器</li>
</ul>
<p>*/</p>
<p>@Controller</p>
<p>public class AdminController {</p>
<p>@Autowired</p>
<p>private UserRoleService userRoleService;</p>
<p>@Autowired</p>
<p>private LoginService loginService;</p>
<p>@Autowired</p>
<p>private UserInfoService userInfoService;</p>
<p>@Autowired</p>
<p>private CommodityService commodityService;</p>
<p>@Autowired</p>
<p>private NoticesService noticesService;</p>
<p>/**</p>
<ul>
<li>管理员跳转登录</li>
</ul>
<p>*/</p>
<p>@GetMapping(“/admin”)</p>
<p>public String admintologin() {</p>
<p>return “admin/login/login”;</p>
<p>/**</p>
<ul>
<li><p>管理员登录</p>
</li>
<li><p>1.判断输入账号的类型</p>
</li>
<li><p>2.判断是否为管理员或者超级管理员</p>
</li>
<li><p>3.登录</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@PostMapping(“/admin/login”)</p>
<p>public ResultVo adminlogin(@RequestBody Login login, HttpSession session){</p>
<p>System.out.println(“测试是否进入！！！”);</p>
<p>String account=login.getUsername();</p>
<p>String password=login.getPassword();</p>
<p>String vercode=login.getVercode();</p>
<p>UsernamePasswordToken token;</p>
<p>if(!ValidateCode.code.equalsIgnoreCase(vercode)){</p>
<p>return new ResultVo(false,StatusCode.ERROR,”请输入正确的验证码”);</p>
<p>//判断输入的账号是否手机号</p>
<p>if (!JustPhone.justPhone(account)) {</p>
<p>//输入的是用户名</p>
<p>String username = account;</p>
<p>//盐加密</p>
<p>token=new UsernamePasswordToken(username, new Md5Hash(password,”Game-shops”).toString());</p>
<p>}else {</p>
<p>//输入的是手机号</p>
<p>String mobilephone = account;</p>
<p>login.setMobilephone(mobilephone);</p>
<p>//将封装的login中username变为null</p>
<p>login.setUsername(null);</p>
<p>//盐加密</p>
<p>token=new UsernamePasswordToken(mobilephone, new Md5Hash(password,”Game-shops”).toString());</p>
<p>Subject subject= SecurityUtils.getSubject();</p>
<p>try {</p>
<p>subject.login(token);</p>
<p>//盐加密</p>
<p>String passwords = new Md5Hash(password, “Game-shops”).toString();</p>
<p>login.setPassword(passwords);</p>
<p>Login login1 = loginService.userLogin(login);</p>
<p>//查询登录者的权限</p>
<p>Integer roleId = userRoleService.LookUserRoleId(login1.getUserid());</p>
<p>if (roleId == 2 || roleId == 3){</p>
<p>session.setAttribute(“admin”,login1.getUsername());</p>
<p>session.setAttribute(“username”,login1.getUsername());</p>
<p>return new ResultVo(true,StatusCode.OK,”登录成功”);</p>
<p>return new ResultVo(true,StatusCode.ACCESSERROR,”权限不足”);</p>
<p>}catch (UnknownAccountException e){</p>
<p>return new ResultVo(true,StatusCode.LOGINERROR,”用户名不存在”);</p>
<p>}catch (IncorrectCredentialsException e){</p>
<p>return new ResultVo(true,StatusCode.LOGINERROR,”密码错误”);</p>
<p>/**</p>
<ul>
<li><p>用户列表</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@GetMapping(“/admin/userlist”)</p>
<p>public String userlist(){</p>
<p>return “/admin/user/userlist”;</p>
<p>/**</p>
<ul>
<li><p>管理员列表</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@RequiresPermissions(“admin:set”)</p>
<p>@GetMapping(“/admin/adminlist”)</p>
<p>public String adminlist(){</p>
<p>return “/admin/user/adminlist”;</p>
<p>/**</p>
<ul>
<li><p>分页查询不同角色用户信息</p>
</li>
<li><p>roleid：1普通成员 2管理员</p>
</li>
<li><p>userstatus：1正常 0封号</p>
</li>
</ul>
<p>*/</p>
<p>@GetMapping(“/admin/userlist/{roleid}/{userstatus}”)</p>
<p>@ResponseBody</p>
<p>public LayuiPageVo userlist(int limit, int page,@PathVariable(“roleid”) Integer roleid,@PathVariable(“userstatus”) Integer userstatus) {</p>
<p>List<UserInfo> userInfoList = userInfoService.queryAllUserInfo((page - 1) * limit, limit,roleid,userstatus);</UserInfo></p>
<p>Integer dataNumber = userInfoService.queryAllUserCount(roleid);</p>
<p>return new LayuiPageVo(“”,0,dataNumber,userInfoList);</p>
<p>/**</p>
<ul>
<li><p>设置为管理员或普通成员（roleid）</p>
</li>
<li><p>1：普通成员   2：管理员</p>
</li>
</ul>
<p>*/</p>
<p>@PutMapping(“/admin/set/administrator/{userid}/{roleid}”)</p>
<p>@ResponseBody</p>
<p>public ResultVo setadmin(@PathVariable(“userid”) String userid,@PathVariable(“roleid”) Integer roleid) {</p>
<p>if (roleid == 2){</p>
<p>Integer i = loginService.updateLogin(new Login().setUserid(userid).setRoleid(roleid));</p>
<p>if (i == 1){</p>
<p>userRoleService.UpdateUserRole(new UserRole().setUserid(userid).setRoleid(2).setIdentity(“网站管理员”));</p>
<p>/*<em>发出设置为管理员的系统通知</em>/</p>
<p>Notices notices = new Notices().setId(KeyUtil.genUniqueKey()).setUserid(userid).setTpname(“系统通知”)</p>
<p>.setWhys(“恭喜您已被设置为网站管理员，努力维护网站的良好氛围。”);</p>
<p>noticesService.insertNotices(notices);</p>
<p>return new ResultVo(true, StatusCode.OK, “设置管理员成功”);</p>
<p>return new ResultVo(true, StatusCode.ERROR, “设置管理员失败”);</p>
<p>}else if (roleid == 1){</p>
<p>Integer i = loginService.updateLogin(new Login().setUserid(userid).setRoleid(roleid));</p>
<p>if (i == 1){</p>
<p>userRoleService.UpdateUserRole(new UserRole().setUserid(userid).setRoleid(1).setIdentity(“网站用户”));</p>
<p>/*<em>发出设置为网站用户的系统通知</em>/</p>
<p>Notices notices = new Notices().setId(KeyUtil.genUniqueKey()).setUserid(userid).setTpname(“系统通知”)</p>
<p>.setWhys(“您已被设置为网站用户，希望您再接再厉。”);</p>
<p>noticesService.insertNotices(notices);</p>
<p>return new ResultVo(true, StatusCode.OK, “设置成员成功”);</p>
<p>return new ResultVo(true, StatusCode.ERROR, “设置成员失败”);</p>
<p>return new ResultVo(false,StatusCode.ACCESSERROR,”违规操作”);</p>
<p>/**</p>
<ul>
<li><p>将用户封号或解封（userstatus）</p>
</li>
<li><p>0：封号  1：解封</p>
</li>
</ul>
<p>*/</p>
<p>@PutMapping(“/admin/user/forbid/{userid}/{userstatus}”)</p>
<p>@ResponseBody</p>
<p>public ResultVo adminuserlist(@PathVariable(“userid”) String userid,@PathVariable(“userstatus”) Integer userstatus) {</p>
<p>if (userstatus == 0){</p>
<p>Integer i = loginService.updateLogin(new Login().setUserid(userid).setUserstatus(userstatus));</p>
<p>Integer j = userInfoService.UpdateUserInfo(new UserInfo().setUserid(userid).setUserstatus(userstatus));</p>
<p>if (i ==1 &amp;&amp; j == 1){</p>
<p>/*<em>发出封号的系统通知</em>/</p>
<p>Notices notices = new Notices().setId(KeyUtil.genUniqueKey()).setUserid(userid).setTpname(“系统通知”)</p>
<p>.setWhys(“因为您的不良行为，您在该网站的账号已被封号。”);</p>
<p>noticesService.insertNotices(notices);</p>
<p>return new ResultVo(true, StatusCode.OK, “封号成功”);</p>
<p>return new ResultVo(true, StatusCode.ERROR, “封号失败”);</p>
<p>}else if (userstatus == 1){</p>
<p>Integer i = loginService.updateLogin(new Login().setUserid(userid).setUserstatus(userstatus));</p>
<p>Integer j = userInfoService.UpdateUserInfo(new UserInfo().setUserid(userid).setUserstatus(userstatus));</p>
<p>if (i ==1 &amp;&amp; j == 1){</p>
<p>/*<em>发出解封的系统通知</em>/</p>
<p>Notices notices = new Notices().setId(KeyUtil.genUniqueKey()).setUserid(userid).setTpname(“系统通知”)</p>
<p>.setWhys(“您在该网站的账号已被解封，希望您保持良好的行为。”);</p>
<p>noticesService.insertNotices(notices);</p>
<p>return new ResultVo(true, StatusCode.OK, “解封成功”);</p>
<p>return new ResultVo(true, StatusCode.ERROR, “解封失败”);</p>
<p>return new ResultVo(false,StatusCode.ACCESSERROR,”违规操作”);</p>
<p>/**</p>
<ul>
<li><p>管理员商品列表</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@GetMapping(“/admin/product”)</p>
<p>public String adminproduct(){</p>
<p>return “/admin/product/productlist”;</p>
<p>/**</p>
<ul>
<li>分页管理员查看各类商品信息</li>
</ul>
<p>*前端传入页码、分页数量</p>
<p>*前端传入商品信息状态码（commstatus）–&gt;全部:100，违规:0，已审核:1，待审核:3 已完成:4</p>
<ul>
<li>因为是管理员查询，将userid设置为空</li>
</ul>
<p>*/</p>
<p>@GetMapping(“/admin/commodity/{commstatus}”)</p>
<p>@ResponseBody</p>
<p>public LayuiPageVo userCommodity(@PathVariable(“commstatus”) Integer commstatus, int limit, int page) {</p>
<p>if(commstatus==100){</p>
<p>List<Commodity> commodityList = commodityService.queryAllCommodity((page - 1) * limit, limit, null, null);</Commodity></p>
<p>Integer dataNumber = commodityService.queryCommodityCount(null, null);</p>
<p>return new LayuiPageVo(“”,0,dataNumber,commodityList);</p>
<p>}else{</p>
<p>List<Commodity> commodityList = commodityService.queryAllCommodity((page - 1) * limit, limit, null, commstatus);</Commodity></p>
<p>Integer dataNumber = commodityService.queryCommodityCount(null, commstatus);</p>
<p>return new LayuiPageVo(“”,0,dataNumber,commodityList);</p>
<p>/**</p>
<ul>
<li><p>管理员对商品的操作</p>
</li>
<li><p>前端传入商品id（commid）</p>
</li>
<li><p>前端传入操作的商品状态（commstatus）–&gt;违规:0  通过审核:1</p>
</li>
<li><p>*/</p>
</li>
</ul>
<p>@ResponseBody</p>
<p>@PutMapping(“/admin/changecommstatus/{commid}/{commstatus}”)</p>
<p>public ResultVo ChangeCommstatus(@PathVariable(“commid”) String commid, @PathVariable(“commstatus”) Integer commstatus) {</p>
<p>Integer i = commodityService.ChangeCommstatus(commid, commstatus);</p>
<p>if (i == 1){</p>
<p>/*<em>发出商品审核结果的系统通知</em>/</p>
<p>Commodity commodity = commodityService.LookCommodity(new Commodity().setCommid(commid));</p>
<p>if (commstatus == 0){</p>
<p>Notices notices = new Notices().setId(KeyUtil.genUniqueKey()).setUserid(commodity.getUserid()).setTpname(“商品审核”)</p>
<p>.setWhys(“您的商品 &lt;a href=/product-detail/“+commodity.getCommid()+” style=&quot;color:#08bf91&quot; target=&quot;_blank&quot; &gt;”+commodity.getCommname()+” 未通过审核，目前不支持公开发布。”);</p>
<p>noticesService.insertNotices(notices);</p>
<p>}else if (commstatus == 1){</p>
<p>Notices notices = new Notices().setId(KeyUtil.genUniqueKey()).setUserid(commodity.getUserid()).setTpname(“商品审核”)</p>
<p>.setWhys(“您的商品 &lt;a href=/product-detail/“+commodity.getCommid()+” style=&quot;color:#08bf91&quot; target=&quot;_blank&quot; &gt;”+commodity.getCommname()+” 已通过审核，快去看看吧。”);</p>
<p>noticesService.insertNotices(notices);</p>
<p>return new ResultVo(true,StatusCode.OK,”操作成功”);</p>
<p>return new ResultVo(false,StatusCode.ERROR,”操作失败”);</p>
<p><span hidden>——————————PayStart——————————</span></p>
<hr>
<iframe id="source-code" name="content_iframe" marginwidth="0" marginheight="0" width="100%" src="/include/pay.html?auto=false&price0=119&price1=79&price2=79" style="height: 260px;" frameborder="0"></iframe>
<blockquote style="background: #f5f5f5;border-left: 3px solid #f57e42;list-style: none;margin: 0.2em 0px 2px;font-size: 12px;"><p>项目链接：<br>https://javayms.github.io?id=541524180701201jg<br>https://javayms.pages.dev?id=541524180701201jg</p></blockquote>
    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
			<a href="/tags/SpringBoot/" rel="tag"><i class="fa fa-tag"></i> SpringBoot</a>
			<a href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag"><i class="fa fa-tag"></i> 游戏</a>

          </div>

        


        
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt=""
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">购买方式见各详情页<b>底部</b><br>所有项目均可<b><a href="/remote">免费远程</a></b>搭建调试运行</div>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        



        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
<div class="moon-menu">
  <div class="moon-menu-items">
    
    <div id="moon-menu-item-back2bottom" class="moon-menu-item">
      <i class='fas fa-chevron-down'></i>    </div>
    
    <div id="moon-menu-item-back2top" class="moon-menu-item">
      <i class='fas fa-chevron-up'></i>    </div>
    
  </div>
  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon"><i class='fas fa-ellipsis-v'></i></div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div><script src="/js/injector.js"></script>
</body>
</html>
